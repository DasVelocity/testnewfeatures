<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ScriptBlox â€” Roblox Scripts</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --bg:#0a0a0f;
      --surface:#13131a;
      --border:rgba(255,255,255,.08);
      --text:#e4e4e7;
      --muted:#71717a;
      --accent:#8b5cf6;
      --accent-hover:#7c3aed;
      --blue:#2563eb;
      --blue-hover:#1d4ed8;
      --orange:#f97316;
    }
    body{
      font-family:'Space Grotesk',sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      flex-direction:column;
      overflow-x:hidden;
      position:relative;
    }
    .bg-grid{
      position:fixed;
      inset:0;
      background-image:
        linear-gradient(rgba(139,92,246,0.04) 1px,transparent 1px),
        linear-gradient(90deg,rgba(139,92,246,0.04) 1px,transparent 1px);
      background-size:60px 60px;
      animation:gridMove 25s linear infinite;
      pointer-events:none;
    }
    @keyframes gridMove{0%{transform:translate(0,0)}100%{transform:translate(60px,60px)}}
    .bg-gradient{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .bg-gradient::before,
    .bg-gradient::after{
      content:'';
      position:absolute;
      width:700px;
      height:700px;
      border-radius:50%;
      filter:blur(120px);
      opacity:.18;
      animation:float 18s ease-in-out infinite;
    }
    .bg-gradient::before{
      background:radial-gradient(circle,var(--accent) 0%,transparent 70%);
      top:-350px;left:-250px;
    }
    .bg-gradient::after{
      background:radial-gradient(circle,#ec4899 0%,transparent 70%);
      bottom:-350px;right:-250px;
      animation-delay:-9s;
    }
    @keyframes float{0%,100%{transform:translate(0,0) scale(1)}50%{transform:translate(60px,60px) scale(1.15)}}
    header{
      position:relative;
      z-index:10;
      padding:1.5rem 2rem;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid var(--border);
      backdrop-filter:blur(12px);
      background:rgba(10,10,15,0.85);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:.75rem;
    }
    .brand div{
      width:32px;height:32px;
      border-radius:8px;
      background:var(--accent);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.2rem;
      color:#fff;
      font-weight:700;
    }
    .brand-text .title{
      font-size:1.25rem;font-weight:700;letter-spacing:-.02em;
    }
    .brand-text .tag{
      font-size:.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:.05em;
    }
    nav{
      display:flex;gap:2rem;
    }
    .nav-link{
      color:var(--muted);
      text-decoration:none;
      font-size:.9rem;
      font-weight:500;
      position:relative;
      transition:color .2s;
      cursor:pointer;
    }
    .nav-link:hover,.nav-link.active{color:var(--text);}
    .nav-link::after{
      content:'';
      position:absolute;
      bottom:-4px;
      left:0;
      width:0;
      height:2px;
      background:var(--accent);
      transition:width .3s;
    }
    .nav-link:hover::after{width:100%;}
    main{
      flex:1;
      padding:4rem 2rem;
      max-width:1200px;
      margin:0 auto;
      width:100%;
    }
    .section{
      display:none;
    }
    .section.active{
      display:block;
      animation:fadeIn .6s ease-out;
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
    .scripts-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
      gap:1.5rem;
      margin-top:2rem;
    }
    .script-card{
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:16px;
      overflow:hidden;
      transition:transform .2s,box-shadow .2s;
      cursor:pointer;
    }
    .script-card:hover{
      transform:translateY(-4px);
      box-shadow:0 16px 48px rgba(0,0,0,0.4),inset 0 0 20px rgba(139,92,246,0.05);
    }
    .script-thumbnail{
      width:100%;
      height:160px;
      object-fit:cover;
      background:var(--bg);
    }
    .script-header{
      padding:1rem;
      display:flex;
      align-items:flex-start;
      gap:.75rem;
    }
    .game-icon{
      width:32px;
      height:32px;
      border-radius:6px;
      object-fit:cover;
    }
    .script-title{
      font-size:1.1rem;
      font-weight:600;
      margin-bottom:.25rem;
      line-height:1.3;
    }
    .script-meta{
      display:flex;
      flex-direction:column;
      gap:.25rem;
      font-size:.85rem;
      color:var(--muted);
    }
    .script-author{
      color:var(--accent);
      font-weight:500;
    }
    .script-game{
      display:flex;
      align-items:center;
      gap:.5rem;
    }
    .script-discord{
      color:var(--blue);
    }
    .upload-form{
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:24px;
      padding:2.5rem;
      max-width:600px;
      margin:0 auto;
    }
    .form-group{
      margin-bottom:1.5rem;
    }
    .form-label{
      display:block;
      font-weight:600;
      margin-bottom:.5rem;
      color:var(--text);
    }
    .form-input,
    .form-textarea{
      width:100%;
      background:var(--bg);
      border:1px solid var(--border);
      border-radius:10px;
      padding:1rem;
      font-family:inherit;
      color:var(--text);
      font-size:.95rem;
      transition:border-color .2s;
    }
    .form-input:focus,
    .form-textarea:focus{
      outline:none;
      border-color:var(--accent);
    }
    .form-textarea{
      min-height:200px;
      resize:vertical;
    }
    .thumbnail-preview{
      width:100%;
      height:200px;
      object-fit:cover;
      border-radius:10px;
      margin-top:.5rem;
      display:none;
      background:var(--bg);
    }
    .file-input{
      width:100%;
      padding:1rem;
      background:var(--bg);
      border:1px dashed var(--border);
      border-radius:10px;
      text-align:center;
      cursor:pointer;
      color:var(--muted);
    }
    .file-input:hover{
      border-color:var(--accent);
      color:var(--text);
    }
    .game-info{
      display:flex;
      align-items:center;
      gap:1rem;
      margin-top:.5rem;
      padding:1rem;
      background:var(--bg);
      border-radius:10px;
      display:none;
    }
    .fetch-btn{
      background:var(--accent);
      color:#fff;
      border:none;
      padding:.75rem 1.5rem;
      border-radius:10px;
      font-weight:600;
      cursor:pointer;
      transition:background .2s;
      margin-top:.5rem;
    }
    .fetch-btn:hover,
    .fetch-btn:disabled:hover{
      background:var(--accent-hover);
    }
    .fetch-btn:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
    .publish-btn{
      background:var(--blue);
      color:#fff;
      border:none;
      font-weight:600;
      font-size:1rem;
      border-radius:10px;
      padding:1rem 2rem;
      width:100%;
      cursor:pointer;
      transition:background .2s;
      margin-top:1rem;
    }
    .publish-btn:hover{
      background:var(--blue-hover);
    }
    .publish-btn:disabled{
      background:var(--muted);
      cursor:not-allowed;
    }
    .no-scripts{
      text-align:center;
      padding:3rem;
      color:var(--muted);
      font-size:1.1rem;
    }
    h1{
      font-size:2rem;
      font-weight:700;
      margin-bottom:2rem;
      text-align:center;
    }
    @media(max-width:700px){
      header{flex-direction:column;gap:1rem;}
      nav{gap:1.2rem;justify-content:center;flex-wrap:wrap;}
      main{padding:3rem 1.2rem;}
      .scripts-grid{grid-template-columns:1fr;}
      .upload-form{padding:2rem;}
    }
  </style>
</head>
<body>
  <div class="bg-grid"></div>
  <div class="bg-gradient"></div>
  <header>
    <div class="brand">
      <div>S</div>
      <div class="brand-text">
        <div class="title">ScriptBlox</div>
        <div class="tag">Roblox Scripts</div>
      </div>
    </div>
    <nav>
      <span class="nav-link active" onclick="showSection('home')">Home</span>
      <span class="nav-link" onclick="showSection('upload')">Upload</span>
    </nav>
  </header>
  <main>
    <section id="home" class="section active">
      <h1>Latest Scripts</h1>
      <div id="scripts-grid" class="scripts-grid" style="display:none;"></div>
      <div id="no-scripts" class="no-scripts">No scripts yet. Be the first to upload!</div>
    </section>
    <section id="upload" class="section">
      <h1>Upload a Script</h1>
      <form id="upload-form" class="upload-form">
        <div class="form-group">
          <label class="form-label">Title</label>
          <input type="text" class="form-input" id="script-title" name="title" required>
        </div>
        <div class="form-group">
          <label class="form-label">Roblox Game URL</label>
          <input type="url" class="form-input" id="game-url" placeholder="https://www.roblox.com/games/1234567890/Game-Name" required>
          <button type="button" class="fetch-btn" onclick="fetchGameInfo()">Fetch Game Info</button>
          <div id="game-info" class="game-info">
            <img id="game-icon" class="game-icon" alt="Game Icon">
            <span id="game-name"></span>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Thumbnail</label>
          <input type="file" class="file-input" id="thumbnail-input" accept="image/*" onchange="previewThumbnail()">
          <img id="thumbnail-preview" class="thumbnail-preview" alt="Thumbnail Preview">
        </div>
        <div class="form-group">
          <label class="form-label">Script Code</label>
          <textarea class="form-textarea" id="script-code" name="code" placeholder="-- Enter your Lua script here&#10;print('Hello, Roblox!')" required></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Made by</label>
          <input type="text" class="form-input" id="author" name="author" required>
        </div>
        <div class="form-group">
          <label class="form-label">Discord Server (optional)</label>
          <input type="url" class="form-input" id="discord" name="discord" placeholder="https://discord.gg/invite-code">
        </div>
        <button type="submit" class="publish-btn" disabled>Publish Script</button>
      </form>
    </section>
  </main>
  <script>
    async function getScripts() {
      const res = await fetch('/api/scripts');
      return await res.json();
    }

    function showSection(sectionId) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      event.target.classList.add('active');
      if (sectionId === 'home') {
        renderScripts();
      }
    }

    async function fetchGameInfo() {
      const url = document.getElementById('game-url').value;
      if (!url) return;
      const btn = document.querySelector('.fetch-btn');
      btn.disabled = true;
      btn.textContent = 'Fetching...';
      try {
        const match = url.match(/games\/(\d+)/);
        if (!match) throw new Error('Invalid Roblox game URL');
        const placeId = match[1];

        const placeRes = await fetch(`https://games.roblox.com/v1/games/multiget-place-details?placeIds=${placeId}`);
        const placeData = await placeRes.json();
        if (!placeData.data[0]) throw new Error('Game not found');
        const universeId = placeData.data[0].universeId;

        const gameRes = await fetch(`https://games.roblox.com/v1/games?universeIds=${universeId}`);
        const gameData = await gameRes.json();
        if (!gameData.data[0]) throw new Error('Game details not found');
        const game = gameData.data[0];

        document.getElementById('game-icon').src = game.universeAvatarType === 'User' ? 
          `https://www.roblox.com/headshot-thumbnail/image?userId=${game.creatorId}&width=150&height=150&format=png` :
          `https://thumbnails.roblox.com/v1/groups/icon?groupId=${game.creatorId}&size=150x150&format=Png&isCircular=false`;
        document.getElementById('game-name').textContent = game.name;
        document.getElementById('game-info').style.display = 'flex';

        checkFormValidity();
      } catch (error) {
        alert('Error fetching game info: ' + error.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'Fetch Game Info';
      }
    }

    function previewThumbnail() {
      const file = document.getElementById('thumbnail-input').files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          document.getElementById('thumbnail-preview').src = e.target.result;
          document.getElementById('thumbnail-preview').style.display = 'block';
          checkFormValidity();
        };
        reader.readAsDataURL(file);
      }
    }

    function checkFormValidity() {
      const title = document.getElementById('script-title').value;
      const code = document.getElementById('script-code').value;
      const author = document.getElementById('author').value;
      const gameUrl = document.getElementById('game-url').value;
      const hasThumbnail = document.getElementById('thumbnail-preview').style.display !== 'none';
      const hasGameInfo = document.getElementById('game-info').style.display !== 'none';
      document.querySelector('.publish-btn').disabled = !title || !code || !author || !gameUrl || !hasThumbnail || !hasGameInfo;
    }

    document.getElementById('upload-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData();
      formData.append('title', document.getElementById('script-title').value);
      formData.append('code', document.getElementById('script-code').value);
      formData.append('author', document.getElementById('author').value);
      formData.append('discord', document.getElementById('discord').value || '');
      formData.append('gameIcon', document.getElementById('game-icon').src);
      formData.append('gameName', document.getElementById('game-name').textContent);
      const file = document.getElementById('thumbnail-input').files[0];
      if (file) formData.append('thumbnail', file);

      try {
        const res = await fetch('/api/scripts', {method: 'POST', body: formData});
        if (res.ok) {
          alert('Script published!');
          e.target.reset();
          document.getElementById('thumbnail-preview').style.display = 'none';
          document.getElementById('game-info').style.display = 'none';
          showSection('home');
        } else {
          alert('Publish failed');
        }
      } catch (error) {
        alert('Error: ' + error.message);
      }
    });

    async function renderScripts() {
      const scripts = await getScripts();
      const grid = document.getElementById('scripts-grid');
      const noScripts = document.getElementById('no-scripts');
      if (scripts.length === 0) {
        grid.style.display = 'none';
        noScripts.style.display = 'block';
        return;
      }
      grid.style.display = 'grid';
      noScripts.style.display = 'none';
      grid.innerHTML = scripts.map(script => `
        <div class="script-card" onclick="window.location.href='script.html?id=${script.id}'">
          <img class="script-thumbnail" src="${script.thumbnail_url}" alt="Thumbnail">
          <div class="script-header">
            <img class="game-icon" src="${script.game_icon}" alt="Game Icon">
            <div>
              <div class="script-title">${script.title}</div>
              <div class="script-meta">
                <div class="script-author">By ${script.author}</div>
                <div class="script-game">
                  <span>ðŸŽ® ${script.game_name}</span>
                </div>
                ${script.discord ? `<a href="${script.discord}" class="script-discord" target="_blank"><i class="fab fa-discord"></i></a>` : ''}
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }

    document.querySelectorAll('.form-input, .form-textarea').forEach(input => {
      input.addEventListener('input', checkFormValidity);
    });

    renderScripts();
  </script>
</body>
</html>